<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام المختبر البيطري</title>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }
        .screen { display: none; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input, select, button, textarea { width: 100%; padding: 10px; margin-top: 5px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .error { color: red; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        th { background-color: #f2f2f2; }
        .text-success { color: green; }
        .text-danger { color: red; }
        .text-warning { color: orange; }
        .btn-edit { background-color: #2196F3; }
        .btn-delete { background-color: #f44336; }
        .report-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { 
            getFirestore, collection, addDoc, getDocs, doc, deleteDoc, setDoc, getDoc 
        } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";
        import { 
            getAuth, signInWithEmailAndPassword, signOut, createUserWithEmailAndPassword 
        } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAzXj2yxeKNUgw2wbyP5C6MKrj92A5-ZS8",
            authDomain: "vet-lab-data.firebaseapp.com",
            projectId: "vet-lab-data",
            storageBucket: "vet-lab-data.appspot.com",
            messagingSenderId: "817190318140",
            appId: "1:817190318140:web:fe1827b6b226ddca4f1339",
            measurementId: "G-NQ6LC0VFQ1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Application data
        let users = [];
        let currentUser = null;
        let entries = [];
        let settings = {
            samples: ["دم", "بول", "خزعة"],
            tests: ["فحص دم", "فحص بول", "فحص أنسجة"],
            results: ["سليم", "مريض", "غير محدد"]
        };

        // Animal types
        const animalTypes = [
            {en: "Sheep", ar: "خروف"},
            {en: "Goat", ar: "ماعز"},
            {en: "Cow", ar: "بقر"},
            {en: "Camel", ar: "جمال"}
        ];

        // Initialize the app
        async function startApp() {
            showScreen("welcomeScreen");
            setTimeout(() => showScreen("loginScreen"), 2000);

            // Load data from Firebase
            await Promise.all([
                loadUsersFromFirebase(),
                loadEntriesFromFirebase(),
                loadSettingsFromFirebase()
            ]);

            // Initialize form fields
            populateAnimalTypes();
            populateSelect("sampleType", settings.samples);
            populateSelect("testType", settings.tests);
            populateSelect("resultType", settings.results);

            // Set today's date as default
            const today = new Date().toISOString().slice(0, 10);
            document.getElementById("dateInput").value = today;
            document.getElementById("fromDate").value = today;
            document.getElementById("toDate").value = today;

            // Setup form handler
            document.getElementById("dataForm").addEventListener("submit", function(e) {
                e.preventDefault();
                saveEntry();
            });

            // Hide admin buttons initially
            document.getElementById("settingsBtn").style.display = "none";
            document.getElementById("usersBtn").style.display = "none";
        }

        // Firebase operations
        async function loadUsersFromFirebase() {
            try {
                const querySnapshot = await getDocs(collection(db, "users"));
                users = querySnapshot.docs.map(doc => doc.data());
            } catch (error) {
                console.error("Error loading users:", error);
                alert("حدث خطأ في تحميل بيانات المستخدمين");
            }
        }

        async function loadEntriesFromFirebase() {
            try {
                const querySnapshot = await getDocs(collection(db, "entries"));
                entries = querySnapshot.docs.map(doc => doc.data());
            } catch (error) {
                console.error("Error loading entries:", error);
                alert("حدث خطأ في تحميل البيانات المدخلة");
            }
        }

        async function loadSettingsFromFirebase() {
            try {
                const docRef = doc(db, "settings", "appSettings");
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    settings = docSnap.data();
                }
            } catch (error) {
                console.error("Error loading settings:", error);
                alert("حدث خطأ في تحميل الإعدادات");
            }
        }

        async function saveUserToFirebase(user) {
            try {
                await setDoc(doc(db, "users", user.empId), user);
            } catch (error) {
                console.error("Error saving user:", error);
                throw error;
            }
        }

        async function saveEntryToFirebase(entry) {
            try {
                await addDoc(collection(db, "entries"), entry);
            } catch (error) {
                console.error("Error saving entry:", error);
                throw error;
            }
        }

        async function saveSettingsToFirebase() {
            try {
                await setDoc(doc(db, "settings", "appSettings"), settings);
            } catch (error) {
                console.error("Error saving settings:", error);
                throw error;
            }
        }

        async function deleteUserFromFirebase(empId) {
            try {
                await deleteDoc(doc(db, "users", empId));
            } catch (error) {
                console.error("Error deleting user:", error);
                throw error;
            }
        }

        // Authentication functions
        async function login() {
            const empId = document.getElementById("empId").value.trim();
            const password = document.getElementById("password").value;
            const errorElement = document.getElementById("loginErrors");

            errorElement.textContent = "";

            if (!empId || !password) {
                errorElement.textContent = "الرجاء إدخال الرقم الوظيفي وكلمة المرور";
                return;
            }

            try {
                const userCredential = await signInWithEmailAndPassword(
                    auth, 
                    `${empId}@vetlab.com`, 
                    password
                );
                
                const user = users.find(u => u.empId === empId);
                
                if (user) {
                    currentUser = user;
                    updateUserWelcome();
                    showScreen("dashboardScreen");
                    createUserWithEmailAndPassword(auth, '70062@vetlab.com', '123456')
  .then(() => {
    const adminUser = {
      empId: "70062",
      name: "Admin",
      type: "مسؤول",
      site: "الادارة",
      permissions: { manageUsers: true, manageSettings: true }
    };
    setDoc(doc(db, "users", "70062"), adminUser);
    alert("تم إنشاء المسؤول بنجاح!");
  });
                    // Show/hide admin buttons based on permissions
                    const isAdmin = user.permissions?.manageUsers || false;
                    document.getElementById("settingsBtn").style.display = isAdmin ? "block" : "none";
                    document.getElementById("usersBtn").style.display = isAdmin ? "block" : "none";
                } else {
                    errorElement.textContent = "الرقم الوظيفي غير مسجل في النظام";
                    await signOut(auth);
                }
            } catch (error) {
                console.error("Login error:", error);
                errorElement.textContent = "خطأ في تسجيل الدخول: " + 
                    (error.code === 'auth/wrong-password' ? "كلمة المرور غير صحيحة" : 
                     error.code === 'auth/user-not-found' ? "المستخدم غير موجود" : 
                     "حدث خطأ أثناء تسجيل الدخول");
            }
        }

        async function logout() {
            if (confirm("هل أنت متأكد من تسجيل الخروج؟")) {
                try {
                    await signOut(auth);
                    currentUser = null;
                    showScreen("loginScreen");
                } catch (error) {
                    console.error("Logout error:", error);
                    alert("حدث خطأ أثناء تسجيل الخروج");
                }
            }
        }

        // Application functions
        function showScreen(screenId) {
            document.querySelectorAll(".screen").forEach(screen => {
                screen.style.display = "none";
            });
            document.getElementById(screenId).style.display = "block";
        }

        function openScreen(screenId) {
            showScreen(screenId);
            
            if (screenId === "dashboardScreen") {
                updateUserWelcome();
            } 
            else if (screenId === "entryScreen") {
                clearEntryForm();
            }
            else if (screenId === "settingsScreen") {
                loadSettings();
            }
            else if (screenId === "usersScreen") {
                loadUsersList();
            }
        }

        function updateUserWelcome() {
            if (currentUser) {
                document.getElementById("userWelcome").textContent = `مرحباً ${currentUser.name}`;
                document.getElementById("siteName").value = currentUser.site || "";
            }
        }

        function populateSelect(id, options) {
            const select = document.getElementById(id);
            select.innerHTML = '';
            
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.textContent = `اختر ${id === 'sampleType' ? 'نوع العينة' : 
                                      id === 'testType' ? 'نوع الاختبار' : 'نتيجة الفحص'}`;
            select.appendChild(defaultOption);

            options.forEach(option => {
                const opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
        }

        function clearEntryForm() {
            document.getElementById("dataForm").reset();
            document.getElementById("siteName").value = currentUser?.site || "";
            document.getElementById("dateInput").value = new Date().toISOString().slice(0, 10);
            document.getElementById("entryErrors").textContent = "";
        }

        async function saveEntry() {
            const errorElement = document.getElementById("entryErrors");
            errorElement.textContent = "";

            const animalType = document.getElementById("animalType");
            const animalTypeText = animalType.options[animalType.selectedIndex].text;

            const entry = {
                date: document.getElementById("dateInput").value,
                site: document.getElementById("siteName").value,
                barnName: document.getElementById("barnName").value.trim(),
                licenseNo: document.getElementById("licenseNo").value.trim(),
                animalType: animalTypeText,
                animalTypeEn: animalType.value,
                gender: document.getElementById("gender").value,
                sampleType: document.getElementById("sampleType").value,
                testType: document.getElementById("testType").value,
                resultType: document.getElementById("resultType").value,
                notes: document.getElementById("notes").value.trim(),
                enteredBy: currentUser.name,
                entryDate: new Date().toISOString()
            };

            // Validation
            const errors = [];
            if (!entry.date) errors.push("تاريخ الفحص مطلوب");
            if (!entry.site) errors.push("الموقع مطلوب");
            if (!entry.barnName) errors.push("اسم الحظيرة مطلوب");
            if (!entry.animalType) errors.push("نوع الحيوان مطلوب");
            if (!entry.gender) errors.push("جنس الحيوان مطلوب");
            if (!entry.sampleType) errors.push("نوع العينة مطلوب");
            if (!entry.testType) errors.push("نوع الاختبار مطلوب");
            if (!entry.resultType) errors.push("نتيجة الفحص مطلوبة");

            if (errors.length > 0) {
                errorElement.textContent = errors.join("، ");
                return;
            }

            try {
                await saveEntryToFirebase(entry);
                entries.push(entry);
                alert("تم حفظ البيانات بنجاح");
                clearEntryForm();
                goBack();
            } catch (error) {
                errorElement.textContent = "حدث خطأ أثناء حفظ البيانات: " + error.message;
            }
        }

        function generateReport() {
            const fromDate = document.getElementById("fromDate").value;
            const toDate = document.getElementById("toDate").value;
            const reportContent = document.getElementById("reportContent");

            if (!fromDate || !toDate) {
                alert("الرجاء تحديد تاريخ البداية والنهاية");
                return;
            }

            const filteredEntries = entries.filter(entry => {
                return entry.date >= fromDate && entry.date <= toDate;
            });

            if (filteredEntries.length === 0) {
                reportContent.innerHTML = `
                    <div class="no-data">
                        <p>لا توجد بيانات متاحة للفترة المحددة</p>
                    </div>
                `;
                return;
            }

            const reportDate = new Date().toLocaleDateString('ar-EG');
            
            let html = `
                <div class="report-header">
                    <div>
                        <div class="report-title">تقرير المختبر البيطري</div>
                        <div class="report-meta">الفترة من ${fromDate} إلى ${toDate} - تاريخ التقرير: ${reportDate}</div>
                    </div>
                    <div>
                        <button class="export-btn" onclick="exportToExcel()">تصدير لإكسل</button>
                        <button class="print-btn" onclick="printReport()">طباعة التقرير</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>التاريخ</th>
                            <th>الموقع</th>
                            <th>نوع الحيوان</th>
                            <th>نوع الاختبار</th>
                            <th>النتيجة</th>
                            <th>ملاحظات</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filteredEntries.forEach((entry, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${entry.date}</td>
                        <td>${entry.site}</td>
                        <td>${entry.animalType}</td>
                        <td>${entry.testType}</td>
                        <td class="${entry.resultType === 'سليم' ? 'text-success' : 
                                    entry.resultType === 'مريض' ? 'text-danger' : 'text-warning'}">
                            ${entry.resultType}
                        </td>
                        <td>${entry.notes || '-'}</td>
                    </tr>
                `;
            });

            html += `</tbody></table>`;
            reportContent.innerHTML = html;
        }

        function printReport() {
            const printContent = document.getElementById("reportContent").innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <div style="padding:20px;font-family:'Arial'">
                    <h1 style="text-align:center;margin-bottom:30px">تقرير المختبر البيطري</h1>
                    ${printContent}
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            showScreen("reportScreen");
        }

        function exportToExcel() {
            const table = document.querySelector("#reportContent table");
            if (!table) {
                alert("لا يوجد بيانات للتصدير");
                return;
            }

            let csv = [];
            const rows = table.querySelectorAll("tr");
            
            for (let i = 0; i < rows.length; i++) {
                let row = [], cols = rows[i].querySelectorAll("td, th");
                
                for (let j = 0; j < cols.length; j++) {
                    row.push(cols[j].innerText);
                }
                
                csv.push(row.join(","));
            }

            const csvContent = csv.join("\n");
            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", `تقرير_المختبر_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = "hidden";
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function loadSettings() {
            document.getElementById("sampleList").value = settings.samples.join(", ");
            document.getElementById("testList").value = settings.tests.join(", ");
            document.getElementById("resultList").value = settings.results.join(", ");
            document.getElementById("settingsErrors").textContent = "";
        }

        async function saveSettings() {
            const errorElement = document.getElementById("settingsErrors");
            errorElement.textContent = "";

            try {
                settings.samples = document.getElementById("sampleList").value.split(",")
                    .map(item => item.trim()).filter(item => item);
                settings.tests = document.getElementById("testList").value.split(",")
                    .map(item => item.trim()).filter(item => item);
                settings.results = document.getElementById("resultList").value.split(",")
                    .map(item => item.trim()).filter(item => item);

                await saveSettingsToFirebase();
                
                // Update dropdowns
                populateSelect("sampleType", settings.samples);
                populateSelect("testType", settings.tests);
                populateSelect("resultType", settings.results);

                alert("تم حفظ الإعدادات بنجاح");
            } catch (error) {
                errorElement.textContent = "حدث خطأ أثناء حفظ الإعدادات: " + error.message;
            }
        }

        function loadUsersList() {
            const usersList = document.getElementById("usersList");
            usersList.innerHTML = "";

            if (users.length === 0) {
                usersList.innerHTML = "<p>لا يوجد مستخدمين</p>";
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>الرقم الوظيفي</th>
                            <th>الاسم</th>
                            <th>النوع</th>
                            <th>الموقع</th>
                            <th>إجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            users.forEach((user, index) => {
                html += `
                    <tr>
                        <td>${user.empId}</td>
                        <td>${user.name}</td>
                        <td>${user.type}</td>
                        <td>${user.site}</td>
                        <td>
                            <button onclick="editUser(${index})" class="btn-edit">✏️ تعديل</button>
                            <button onclick="deleteUser(${index})" class="btn-delete">🗑️ حذف</button>
                        </td>
                    </tr>
                `;
            });

            html += `</tbody></table>`;
            usersList.innerHTML = html;
        }

        async function addUser() {
            const errorElement = document.getElementById("userErrors");
            errorElement.textContent = "";

            const empId = document.getElementById("newEmpId").value.trim();
            const name = document.getElementById("newName").value.trim();
            const type = document.getElementById("newType").value;
            const site = document.getElementById("newSite").value.trim();
            const password = document.getElementById("newPassword").value;

            // Validation
            const errors = [];
            if (!empId) errors.push("الرقم الوظيفي مطلوب");
            if (!name) errors.push("اسم المستخدم مطلوب");
            if (!type) errors.push("نوع المستخدم مطلوب");
            if (!site) errors.push("الموقع مطلوب");
            if (!password || password.length < 6) errors.push("كلمة المرور مطلوبة (6 أحرف على الأقل)");

            if (errors.length > 0) {
                errorElement.textContent = errors.join("، ");
                return;
            }

            // Check if user already exists
            if (users.some(u => u.empId === empId)) {
                errorElement.textContent = "الرقم الوظيفي مسجل مسبقاً";
                return;
            }

            // Set permissions based on user type
            const permissions = {
                manageUsers: type === "مسؤول",
                manageSettings: type === "مسؤول",
                viewReports: true,
                addEntries: true
            };

            const newUser = { empId, name, type, site, permissions };

            try {
                // Create user in Authentication
                await createUserWithEmailAndPassword(
                    auth, 
                    `${empId}@vetlab.com`, 
                    password
                );
                
                // Save user to Firestore
                await saveUserToFirebase(newUser);
                users.push(newUser);
                
                // Clear form
                document.getElementById("newEmpId").value = "";
                document.getElementById("newName").value = "";
                document.getElementById("newType").value = "";
                document.getElementById("newSite").value = "";
                document.getElementById("newPassword").value = "";

                alert("تم إضافة المستخدم بنجاح");
                loadUsersList();
            } catch (error) {
                console.error("Error adding user:", error);
                errorElement.textContent = "حدث خطأ أثناء إضافة المستخدم: " + 
                    (error.code === 'auth/email-already-in-use' ? "المستخدم موجود بالفعل" :
                     error.message);
            }
        }

        function editUser(index) {
            const user = users[index];
            if (!user) return;

            if (!confirm(`هل تريد تعديل بيانات المستخدم ${user.name}؟`)) return;

            document.getElementById("newEmpId").value = user.empId;
            document.getElementById("newName").value = user.name;
            document.getElementById("newType").value = user.type;
            document.getElementById("newSite").value = user.site;
            document.getElementById("newPassword").value = "";

            // Remove the old user from the array
            users.splice(index, 1);
        }

        async function deleteUser(index) {
            const user = users[index];
            if (!user) return;

            if (user.empId === "70062") {
                alert("لا يمكن حذف المسؤول الرئيسي");
                return;
            }

            if (confirm(`هل أنت متأكد من حذف المستخدم ${user.name}؟`)) {
                try {
                    await deleteUserFromFirebase(user.empId);
                    users.splice(index, 1);
                    loadUsersList();
                    alert("تم حذف المستخدم بنجاح");
                } catch (error) {
                    console.error("Error deleting user:", error);
                    alert("حدث خطأ أثناء حذف المستخدم: " + error.message);
                }
            }
        }

        function goBack() {
            if (currentUser) {
                showScreen("dashboardScreen");
            } else {
                showScreen("loginScreen");
            }
        }

        // Initialize the app when loaded
        window.onload = startApp;
        
        // Expose functions to HTML
        window.login = login;
        window.logout = logout;
        window.openScreen = openScreen;
        window.goBack = goBack;
        window.saveEntry = saveEntry;
        window.generateReport = generateReport;
        window.printReport = printReport;
        window.exportToExcel = exportToExcel;
        window.saveSettings = saveSettings;
        window.addUser = addUser;
        window.editUser = editUser;
        window.deleteUser = deleteUser;
    </script>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen">
        <h1 style="text-align: center; margin-top: 100px;">مرحباً بكم في نظام المختبر البيطري</h1>
        <p style="text-align: center;">جاري التحميل...</p>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="screen">
        <h2 style="text-align: center;">تسجيل الدخول</h2>
        <div style="max-width: 400px; margin: 0 auto;">
            <div class="form-group">
                <label for="empId">الرقم الوظيفي:</label>
                <input type="text" id="empId" placeholder="أدخل الرقم الوظيفي">
            </div>
            <div class="form-group">
                <label for="password">كلمة المرور:</label>
                <input type="password" id="password" placeholder="أدخل كلمة المرور">
            </div>
            <div id="loginErrors" class="error" style="min-height: 20px;"></div>
            <button onclick="login()" style="margin-top: 20px;">تسجيل الدخول</button>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="screen">
        <h2 id="userWelcome" style="text-align: center;"></h2>
        <div style="max-width: 500px; margin: 0 auto;">
            <button onclick="openScreen('entryScreen')" style="margin-bottom: 10px;">إدخال بيانات جديدة</button>
            <button onclick="openScreen('reportScreen')" style="margin-bottom: 10px;">عرض التقارير</button>
            <button id="settingsBtn" onclick="openScreen('settingsScreen')" style="margin-bottom: 10px;">الإعدادات</button>
            <button id="usersBtn" onclick="openScreen('usersScreen')" style="margin-bottom: 10px;">إدارة المستخدمين</button>
            <button onclick="logout()" style="background-color: #f44336;">تسجيل الخروج</button>
        </div>
    </div>

    <!-- Entry Screen -->
    <div id="entryScreen" class="screen">
        <h2 style="text-align: center;">إدخال بيانات جديدة</h2>
        <form id="dataForm" style="max-width: 600px; margin: 0 auto;">
            <div class="form-group">
                <label for="dateInput">تاريخ الفحص:</label>
                <input type="date" id="dateInput" required>
            </div>
            <div class="form-group">
                <label for="siteName">الموقع:</label>
                <input type="text" id="siteName" required>
            </div>
            <div class="form-group">
                <label for="barnName">اسم الحظيرة:</label>
                <input type="text" id="barnName" required>
            </div>
            <div class="form-group">
                <label for="licenseNo">رقم الرخصة:</label>
                <input type="text" id="licenseNo">
            </div>
            <div class="form-group">
                <label for="animalType">نوع الحيوان:</label>
                <select id="animalType" required></select>
            </div>
            <div class="form-group">
                <label for="gender">جنس الحيوان:</label>
                <select id="gender" required>
                    <option value="">اختر الجنس</option>
                    <option value="ذكر">ذكر</option>
                    <option value="أنثى">أنثى</option>
                </select>
            </div>
            <div class="form-group">
                <label for="sampleType">نوع العينة:</label>
                <select id="sampleType" required></select>
            </div>
            <div class="form-group">
                <label for="testType">نوع الاختبار:</label>
                <select id="testType" required></select>
            </div>
            <div class="form-group">
                <label for="resultType">نتيجة الفحص:</label>
                <select id="resultType" required></select>
            </div>
            <div class="form-group">
                <label for="notes">ملاحظات:</label>
                <textarea id="notes" rows="3"></textarea>
            </div>
            <div id="entryErrors" class="error" style="min-height: 20px;"></div>
            <button type="submit">حفظ البيانات</button>
            <button type="button" onclick="goBack()" style="background-color: #f44336; margin-top: 10px;">العودة</button>
        </form>
    </div>

    <!-- Report Screen -->
    <div id="reportScreen" class="screen">
        <h2 style="text-align: center;">التقارير</h2>
        <div style="max-width: 600px; margin: 0 auto;">
            <div class="form-group">
                <label for="fromDate">من تاريخ:</label>
                <input type="date" id="fromDate">
            </div>
            <div class="form-group">
                <label for="toDate">إلى تاريخ:</label>
                <input type="date" id="toDate">
            </div>
            <button onclick="generateReport()">عرض التقرير</button>
            <button onclick="goBack()" style="background-color: #f44336; margin-top: 10px;">العودة</button>
            <div id="reportContent" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settingsScreen" class="screen">
        <h2 style="text-align: center;">الإعدادات</h2>
        <div style="max-width: 600px; margin: 0 auto;">
            <div class="form-group">
                <label for="sampleList">أنواع العينات (مفصولة بفاصلة):</label>
                <textarea id="sampleList" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="testList">أنواع الاختبارات (مفصولة بفاصلة):</label>
                <textarea id="testList" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="resultList">النتائج المحتملة (مفصولة بفاصلة):</label>
                <textarea id="resultList" rows="3"></textarea>
            </div>
            <div id="settingsErrors" class="error" style="min-height: 20px;"></div>
            <button onclick="saveSettings()">حفظ الإعدادات</button>
            <button onclick="goBack()" style="background-color: #f44336; margin-top: 10px;">العودة</button>
        </div>
    </div>

    <!-- Users Management Screen -->
    <div id="usersScreen" class="screen">
        <h2 style="text-align: center;">إدارة المستخدمين</h2>
        <div style="max-width: 800px; margin: 0 auto;">
            <h3>إضافة مستخدم جديد</h3>
            <div class="form-group">
                <label for="newEmpId">الرقم الوظيفي:</label>
                <input type="text" id="newEmpId">
            </div>
            <div class="form-group">
                <label for="newName">اسم المستخدم:</label>
                <input type="text" id="newName">
            </div>
            <div class="form-group">
                <label for="newType">نوع المستخدم:</label>
                <select id="newType">
                    <option value="">اختر النوع</option>
                    <option value="مسؤول">مسؤول</option>
                    <option value="فني">فني</option>
                    <option value="سوق المواشي">سوق المواشي</option>
                </select>
            </div>
            <div class="form-group">
                <label for="newSite">الموقع:</label>
                <input type="text" id="newSite">
            </div>
            <div class="form-group">
                <label for="newPassword">كلمة المرور:</label>
                <input type="password" id="newPassword">
            </div>
            <div id="userErrors" class="error" style="min-height: 20px;"></div>
            <button onclick="addUser()">إضافة مستخدم</button>
            
            <h3 style="margin-top: 30px;">قائمة المستخدمين</h3>
            <div id="usersList"></div>
            <button onclick="goBack()" style="background-color: #f44336; margin-top: 20px;">العودة</button>
        </div>
    </div>
</body>
</html>
